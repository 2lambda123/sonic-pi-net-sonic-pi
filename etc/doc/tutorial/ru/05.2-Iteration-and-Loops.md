5.2 Iteration and Loops

# Итерации и циклы

До этого момента мы потратили много времени, пробуя разные звуки, которые можно
производить внутри блоков `play` и `sample`. Мы также изучили как разносить эти
звуки во времени, используя `sleep`.

Как ты уже мог выяснить, даже с этими простейшими блоками можно долго забавляться.
Однако, совершенно новое измерение веселья откроется для тебя, когда ты начнешь
использовать мощь блоков кода для струкрутирования твоей музыки и композиций. В
нескольких следующих главах мы рассмотрим некоторые из этих новых инструментов.
Вначале идут итерации и циклы.

## Повторение

Доводилось ли тебе писать код, который ты бы хотел повторить несколько раз? Например,
у тебя могло получиться нечто подобное:

```
play 50
sleep 0.5
sample :elec_blup
sleep 0.5
play 62
sleep 0.25
```

Что если мы захотим повторить его три раза? Что ж, можно было бы выбрать простейший
путь и попросту продублировать код трижды:

```
play 50
sleep 0.5
sample :elec_blup
sleep 0.5
play 62
sleep 0.25

play 50
sleep 0.5
sample :elec_blup
sleep 0.5
play 62
sleep 0.25

play 50
sleep 0.5
sample :elec_blup
sleep 0.5
play 62
sleep 0.25
```

Теперь этот код огромен! Как быть, если захочется поменять сэмпл на `:elec_plip`?
Придется найти все месте с изначальным `:elec_blup` и переключить их. Что еще
важнее, каким образом повторить кусок кода 50 раз или 1000? Это было бы и впрямь
целая куча кода. Гигансткое число строк пришлось бы изменять для каждой правки.

## Итерации

На самом деле сделать повторение кода должно быть не сложнее, чем сказать *сделай
это три раза*. Вобщем-то, так оно и есть. Помнишь ли ты о нашем старом знакомом,
блоке кода? Можно его использовать для отметки начала и конца кода, который
необходимо повторить три раза. Мы добавим специальную конструкцию `3.times`. Так
что, вместо записи *делай это три раза*, мы напишем `3.times do`. Это не очень
сложно. Просто не забывай указывать `end` в конце кода, который надо повторять:

```
3.times do
  play 50
  sleep 0.5
  sample :elec_blup
  sleep 0.5
  play 62
  sleep 0.25
end
```

Ну, разве это не лучше дублирования! Много красивых структур может быть создано
с использованием этой инструкции:

```
4.times do
  play 50
  sleep 0.5
end

8.times do
  play 55, release: 0.2
  sleep 0.25
end

4.times do
  play 50
  sleep 0.5
end
```

## Вложенные итерации

Еще можно поместить итерации внутрь других итераций и получить интересный рисунок.
Например:

```
4.times do
  sample :drum_heavy_kick
  2.times do
    sample :elec_blip2, rate: 2
    sleep 0.25
  end
  sample :elec_snare
  4.times do
    sample :drum_tom_mid_soft
    sleep 0.125
  end
end
```

## Цикличность

Если требуется повторять что-то много раз, то мы можешь обнаружить, что указываешь
очень большие значения, такие как `1000.times do`. В этом случае, наверное лучше
попросить Sonic Pi повторять до бесконечности (или как минимум до того момента,
пока ты не нажал кнопку Stop!). Давай зациклим амен-брейк:

```
loop do
  sample :loop_amen
  sleep sample_duration :loop_amen
end
```

О циклах важно знать, что они работают как черные дыры для кода. Как только
исполнение кода входит в цикл, оно никогда не может покинуть его до тех пор, пока
ты не остановишь его. Код просто будет повторяться по кругу снова и снова вечно.
Это значит, что ты *никогда* не услышишь код, написанный после цикла. К примеру,
тарелка после этого цикла никогда не прозвучит:

```
loop do
  play 50
  sleep 1
end

sample :drum_cymbal_open
```

Теперь пришла пора создать интересные структуры из твоего кода при помощи итераций
и циклов!
