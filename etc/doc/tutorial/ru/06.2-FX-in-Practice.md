6.2 FX in Practice

# Практика использования эффектов

Хотя снаружи они выглядят обманчиво просто, внутри эффекты устроены довольно
сложно. Их простота часто побуждает людей злоупотреблять их использованием. Это
вполне нормально, если у тебя мощный компьютер. Но если, как и я, ты импровизируешь
на Raspberry Pi, то нужно быть аккуратным с нагрузкой. Иначе ритм может начать
прерываться.

Рассмотрим следующий код:

```
loop do
  with_fx :reverb do
    play 60, release: 0.1
    sleep 0.125
  end
end
```

В этом примере мы играем ноту 60 с очень коротким временем затухания. То есть это
короткая нота. Нам нужна реверберация, поэтому мы обернули ее в блок reverb. Пока
что все хорошо. За исключением...

Посмотрим, что делает код. Во-первых, у нас есть `loop`. Это означает, что все,
что внутри нее, повторяется бесконечно. Во-вторых, есть блок `with_fx`. Его роль
в том, чтобы создавать новый эффект реверберации *каждый раз, когда он выполняется*.
Как будто для каждого щипка гитарной струны включается собственная педаль эффекта
реверберации. Здорово, что так можно делать, но это не всегда то, что нужно.
Например, такой код будет трудно выполнять на Raspberry Pi. Создание эффекта
реверберации и ожидание момента, когда он должен быть остановлен и удален, - обо
всем позаботится за тебя блок `with_fx`. Но на это требуются ресурсы процессора,
а они могут быть ограничены.

Как изменить код так, чтобы он больше походил на обычное подключение, где у нашего
гитариста всего *одна* педаль реверберации, и через которую пропускаются все звуки?
Легко:

```
with_fx :reverb do
  loop do
    play 60, release: 0.1
    sleep 0.125
  end
end
```

Мы помещаем наш цикл *внутрь* блока `with_fx`. Таким образом создается всего один
единственный эффект для всех нот, извлекаемых в цикле. Этот вариант намного более
эффективен, и Raspberry Pi с ним хорошо справится.

В качестве компромисса можно предложить использовать `with_fx` на протяжении
нескольких повторений внутри цикла:

```
loop do
  with_fx :reverb do
    16.times do
      play 60, release: 0.1
      sleep 0.125
    end
  end
end
```

То есть новый эффект реверберации будет создаваться через каждые 16 нот.

Помни, ошибок нет, только возможности. Однако, каждый из этих подходов даст разный
звук и разные показатели производительности. Поэтому попрактикуйся и затем используй
тот способ, который для тебя звучит лучше всего и в то же время укладывается в
ограничения быстродействия твоей платформы.
